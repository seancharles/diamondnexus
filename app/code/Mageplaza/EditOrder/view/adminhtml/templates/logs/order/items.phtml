<?php
/**
 * Mageplaza
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Mageplaza.com license that is
 * available through the world-wide-web at this URL:
 * https://www.mageplaza.com/LICENSE.txt
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade this extension to newer
 * version in the future.
 *
 * @category    Mageplaza
 * @package     Mageplaza_EditOrder
 * @copyright   Copyright (c) Mageplaza (https://www.mageplaza.com/)
 * @license     https://www.mageplaza.com/LICENSE.txt
 */

/** @var \Mageplaza\EditOrder\Block\Adminhtml\Logs\Order\Items $block */
?>

<div class="admin__table-wrapper" id="order-items_grid">
    <?php if ($block->checkItemsUpdated()) : ?>
        <?php
            $oldItems = $block->getOldItemsData();
            $newItems = $block->getNewItemsData();
            $rows = ['price', 'qty', 'subtotal', 'tax', 'discount_amount', 'row_subtotal']
        ?>
        <table class="data-table admin__table-primary order-tables">
            <thead>
            <tr class="headings">
                <th class="col-product"><span><?= /** @noEscape */ __('Product') ?></span></th>
                <th class="col-price"><span><?= /** @noEscape */ __('Price') ?></span></th>
                <th class="col-qty"><span><?= /** @noEscape */ __('Qty') ?></span></th>
                <th class="col-subtotal"><span><?= /** @noEscape */ __('Subtotal') ?></span></th>
                <th class="col-tax"><span><?= /** @noEscape */ __('Tax (%)') ?></span></th>
                <th class="col-discount"><span><?= /** @noEscape */ __('Discount') ?></span></th>
                <th class="col-row-total"><span><?= /** @noEscape */ __('Row Subtotal') ?></span></th>
                <th class="col-action"><span><?= /** @noEscape */ __('Action') ?></span></th>
            </tr>
            </thead>
            <?php foreach ($block->getItems() as $proId => $data) : ?>
                <?php $item = $block->getProductById($proId) ?>
                <?php if ($item) : ?>
                    <tbody>
                        <tr>
                            <td class="col-product">
                                <span id="order_item_<?= /** @noEscape */ $item->getId() ?>_title">
                                    <?= $block->escapeHtml($item->getName()) ?>
                                </span>
                            </td>
                            <?php foreach ($rows as $row) : ?>
                                <td class="col-<?= /** @noEscape */ $row ?>">
                                    <?php if ($block->hasOldItem($proId)) : ?>
                                        <?php $old = in_array($row, ['qty', 'tax'], true)
                                            ? $data[$row]
                                            : $block->formatPrice($data[$row])
                                        ?>
                                        <span class="price old-price">
                                            <span><?= /** @noEscape */ __('Old: %1', $old) ?></span>
                                        </span><br/>
                                    <?php endif; ?>
                                    <?php if ($block->isUpdated($proId, $row)) : ?>
                                        <?php $new = in_array($row, ['qty', 'tax'], true)
                                            ? $newItems[$proId][$row]
                                            : $block->formatPrice($newItems[$proId][$row])
                                        ?>
                                        <span class="price old-<?= /** @noEscape */ $row ?> update-data">
                                            <span><?= /** @noEscape */ __('Update: %1', $new) ?></span>
                                        </span>
                                    <?php endif; ?>
                                </td>
                            <?php endforeach; ?>
                            <td class="col-action">
                                <span class="price old-action update-data">
                                    <span><?= /** @noEscape */ $block->getAction($proId) ?></span>
                                </span>
                            </td>
                        </tr>
                    <?php endif; ?>
                </tbody>
            <?php endforeach; ?>
        </table>
    <?php else : ?>
        <table class="admin__table-secondary">
            <caption class="title-no-update"><?= /** @noEscape */ __('There is no update.') ?></caption>
        </table>
    <?php endif ?>
</div>

<style>
    .update-data {
        font-weight: 700;
    }
</style>

